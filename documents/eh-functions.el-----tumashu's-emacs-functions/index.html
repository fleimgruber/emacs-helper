<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>eh-functions.el --- Tumashu&#39;s  emacs functions - Emacs-helper</title>
    <meta charset="utf-8" />
    <meta name="author" content="Feng Shu" />
    <link rel="stylesheet" href="https://tumashu.github.io/emacs-helper/media/css/main.css" type="text/css">
  </head>
<body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="https://tumashu.github.io/emacs-helper/">Emacs-helper</a> <span class="subtitle">(Tumashu 的 emacs 配置)</span></h1>
        <ul>
          <li><a href="https://tumashu.github.io/emacs-helper/documents/">Documents</a></li>
          <li><a href="https://tumashu.github.io/emacs-helper/tags/">Tags</a></li>
          <li><a href="https://tumashu.github.io/emacs-helper/about/">About</a></li>
          <li><a href="https://github.com/tumashu/emacs-helper">GitHub</a></li>
          <li><a href="https://tumashu.github.io/emacs-helper/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="tumashu.github.io/emacs-helper">
        </form>
      </header>
    </div>

<div class="content-and-footer">
<div>
<div class="post">
<h1 class="post-title">eh-functions.el --- Tumashu&#39;s  emacs functions</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org066d888">1. 简介</a></li>
<li><a href="#orgbe9492d">2. 代码</a></li>
</ul>
</div>
</div>
<div id="outline-container-org066d888" class="outline-2">
<h2 id="org066d888"><span class="section-number-2">1</span> 简介</h2>
<div class="outline-text-2" id="text-1">
<p>
这个文件是tumashu个人专用的emacs配置文件，emacs中文用户可以参考。
</p>
</div>
</div>

<div id="outline-container-orgbe9492d" class="outline-2">
<h2 id="orgbe9492d"><span class="section-number-2">2</span> 代码</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-wash-text</span> (text <span style="color: #afd8af;">&amp;optional</span> fill-width indent)
  <span style="color: #FBDE2D;">"Insert text into a temp buffer and wash it,</span>
<span style="color: #FBDE2D;">if `</span><span style="color: #96CBFE;">fill-width</span><span style="color: #FBDE2D;">' is a number, the temp buffer will be filled to the number,</span>
<span style="color: #FBDE2D;">if `</span><span style="color: #96CBFE;">indent</span><span style="color: #FBDE2D;">' is a number ,the temp buffer will be indent the number,</span>
<span style="color: #FBDE2D;">then the formated buffer will be exported with `</span><span style="color: #96CBFE;">buffer-string</span><span style="color: #FBDE2D;">',</span>
<span style="color: #FBDE2D;">this function  derived from `</span><span style="color: #96CBFE;">article-strip-multiple-blank-lines</span><span style="color: #FBDE2D;">' in</span>
<span style="color: #FBDE2D;">`</span><span style="color: #96CBFE;">gnus-art.el</span><span style="color: #FBDE2D;">'."</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (<span style="color: #4c83ff;">with-temp-buffer</span>
    (goto-char (point-min))
    (insert text)
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Make all blank lines empty.</span>
    (goto-char (point-min))
    (<span style="color: #4c83ff;">while</span> (re-search-forward <span style="color: #61CE3C;">"^[[:space:]  \t]+$"</span> nil t)
      (replace-match <span style="color: #61CE3C;">""</span> nil t))

    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Replace multiple empty lines with a single empty line.</span>
    (goto-char (point-min))
    (<span style="color: #4c83ff;">while</span> (re-search-forward <span style="color: #61CE3C;">"^\n</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">(</span><span style="color: #61CE3C;">\n+</span><span style="color: #E9C062;">\\</span><span style="color: #ff0000;">)</span><span style="color: #61CE3C;">"</span> nil t)
      (delete-region (match-beginning 1) (match-end 1)))

    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Remove a leading blank line.</span>
    (goto-char (point-min))
    (<span style="color: #4c83ff;">if</span> (looking-at <span style="color: #61CE3C;">"\n"</span>)
        (delete-region (match-beginning 0) (match-end 0)))

    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Remove a trailing blank line.</span>
    (goto-char (point-max))
    (<span style="color: #4c83ff;">if</span> (looking-at <span style="color: #61CE3C;">"\n"</span>)
        (delete-region (match-beginning 0) (match-end 0)))

    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">remove "{"</span>
    (goto-char (point-min))
    (<span style="color: #4c83ff;">if</span> (looking-at <span style="color: #61CE3C;">"^[[:space:]    \t]*{"</span>)
        (delete-region (match-beginning 0) (match-end 0)))

    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">remove "}"</span>
    (goto-char (point-max))
    (<span style="color: #4c83ff;">if</span> (looking-at <span style="color: #61CE3C;">"}^[[:space:]   \t]*"</span>)
        (delete-region (match-beginning 0) (match-end 0)))

    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">fill buffer</span>
    (<span style="color: #4c83ff;">when</span> fill-width
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">unindent the buffer</span>
      (indent-region (point-min) (point-max) 0)
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">unfill the buffer</span>
      (<span style="color: #4c83ff;">let</span> ((fill-column 100000))
        (fill-region (point-min) (point-max)))
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">fill the buffer to fill-width</span>
      (<span style="color: #4c83ff;">let</span> ((fill-column fill-width))
        (fill-region (point-min) (point-max))))

    <span style="color: #8B8989; font-style: italic;">;;</span><span style="color: #8B8989; font-style: italic;">indent buffer</span>
    (<span style="color: #4c83ff;">when</span> indent
      (indent-region (point-min) (point-max) indent))
    (buffer-string)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-dos2unix</span> ()
  <span style="color: #FBDE2D;">"&#23558;dos&#25442;&#34892;&#26041;&#24335;&#36716;&#25442;&#20026;unix&#30340;&#25442;&#34892;&#26041;&#24335;,&#29992;&#20110;&#21435;&#38500;^M"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (goto-char (point-min))
  (<span style="color: #4c83ff;">while</span> (search-forward <span style="color: #61CE3C;">"\r"</span> nil t) (replace-match <span style="color: #61CE3C;">""</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-unix2dos</span> ()
  <span style="color: #FBDE2D;">"&#23558;unix&#25442;&#34892;&#26041;&#24335;&#36716;&#25442;&#20026;dos&#30340;&#25442;&#34892;&#26041;&#24335;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (goto-char (point-min))
  (<span style="color: #4c83ff;">while</span> (search-forward <span style="color: #61CE3C;">"\n"</span> nil t) (replace-match <span style="color: #61CE3C;">"\r\n"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-revert-buffer-with-gbk</span> ()
  (<span style="color: #4c83ff;">interactive</span>)
  (revert-buffer-with-coding-system 'gbk-dos))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-revert-buffer-with-utf8</span> ()
  (<span style="color: #4c83ff;">interactive</span>)
  (revert-buffer-with-coding-system 'utf-8-unix))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-save-buffer-with-gbk</span> (<span style="color: #afd8af;">&amp;optional</span> arg)
  (<span style="color: #4c83ff;">interactive</span>)
  (set-buffer-file-coding-system 'gbk-dos)
  (save-buffer arg))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-save-buffer-with-utf8</span> (<span style="color: #afd8af;">&amp;optional</span> arg)
  (<span style="color: #4c83ff;">interactive</span>)
  (set-buffer-file-coding-system 'utf-8-unix)
  (save-buffer arg))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-utf8-language-environment</span> ()
  <span style="color: #FBDE2D;">"&#35774;&#32622;utf-8&#35821;&#35328;&#29615;&#22659;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (set-language-environment <span style="color: #61CE3C;">"UTF-8"</span>)
  (set-buffer-file-coding-system 'utf-8-unix)
  (set-clipboard-coding-system 'utf-8-unix)
  (set-file-name-coding-system 'utf-8-unix)
  (set-keyboard-coding-system 'utf-8-unix)
  (set-next-selection-coding-system 'utf-8-unix)
  (set-selection-coding-system 'utf-8-unix)
  (set-terminal-coding-system 'utf-8-unix))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #4c83ff;">defun</span> <span style="color: #ff1493;">eh-gbk-language-environment</span> ()
  <span style="color: #FBDE2D;">"&#35774;&#32622;gbk&#35821;&#35328;&#29615;&#22659;"</span>
  (<span style="color: #4c83ff;">interactive</span>)
  (set-language-environment <span style="color: #61CE3C;">"Chinese-GBK"</span>)
  (set-buffer-file-coding-system 'gbk-dos)
  (set-clipboard-coding-system 'gbk-dos)
  (set-file-name-coding-system 'gbk-dos)
  (set-keyboard-coding-system 'gbk-dos)
  (set-next-selection-coding-system 'gbk-dos)
  (set-selection-coding-system 'gbk-dos)
  (set-terminal-coding-system 'gbk-dos))
</pre>
</div>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2017-07-30</span>
        <span title="last modification date" class="post-info">2017-07-30</span>
        <span title="tags" class="post-info">N/A</span>
        <span title="author" class="post-info">Feng Shu</span>
      </div>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; <span id="footerYear"></span> <a href="mailto:tumashu &lt;at&gt; 163 &lt;dot&gt; com">Feng Shu</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/tumashu/org2web" target="_blank">org2web</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

</div>
</body>
</html>
